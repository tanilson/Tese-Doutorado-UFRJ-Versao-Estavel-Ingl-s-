\chapter{The Helly property and EPG graphs}\label{cap:capiii}

\begin{flushright}
\begin{minipage}[t][0cm][b]{0.47\textwidth}
\emph{
Talento é 1\% inspiração e 99\% transpiração. }
\end{minipage}

\rule[0cm]{7cm}{0.03cm}%{largura}{espessura}

Thomas Edison
\end{flushright}

Neste capítulo examinaremos as relações hierárquicas entre algumas classes EPG e EPG-Helly. Ademais, abordaremos representações $B_1$-EPG de alguns grafos que serão utilizados posteriormente. Primeiro, vamos observar como as classes $B_0$-EPG, $B_0$-EPG-Helly, $B_1$-EPG e $B_1$-EPG-Helly se relacionam, em seguida consideramos as representações $B_1$-EPG de $C_4$'s e do grafo octaedro. Por último, apresentaremos a prova de $NP$-completude do problema de reconhecimento de grafos $B_1$-EPG-Helly.


\section{Subclasses of $B_1$-EPG graphs}

Apesar das classes $B_1$-EPG e $ B_1$-EPG-Helly não coincidirem,  o mesmo não ocorre para as classes $ B_0$-EPG e $ B_0$-EPG-Helly, conforme será visto mais adiante.

Primeiro, observamos que quando não restringimos o número de dobras de cada caminho podemos mostrar que qualquer grafo pode ser representado como um grafo EPG.
É fácil construir representações EPG que verificam o seguinte lema. 

 
 
 \begin{lema} \cite{golumbic2009} \label{lem:todoGrafoEpg}
 Todo grafo é um grafo EPG.
 \end{lema}
%   \begin{prove}
%  Seja $G=(V,E)$ um grafo com vértices $v_1,\dots ,v_n$. Considere a grade $Q$ com linhas $[1,\dots ,n]$ e colunas $[1, 1', 2, 2', \dots, n,n']$. 
 
%  Considere o vértice $v_i$ e denote $N^+(v_i)$= $\{v_j|i<j,(i,j)\in E\}$, onde $N^+(v_i)$= $\{v_{j_1}, \dots, v_{j_k}\}$ é ordenado de acordo com $\{v_{j_1}< \dots < v_{j_k}\}$.   The path $P_i$ on $Q$ is defined starting horizontally from grid point $(1,i)$ to $(i,i)$, continuing vertically to $(i,j_1)$, horizontally to $(i',j_1)$, continuing vertically to $(i,j_2)$, horizontally to $(i',j_2)$, continuing vertically $(i,j_3)$, horizontally $(i',j_3)$, etc. i.e., we alternate between column $i$ and column $i'$ as we go across on each level $j_1, j_2, \dots, j_k$. %reference Figure
%  We prove that $P_i$ on the grid $Q$ is an EPG representation of $G$. For every $i<j,(v_i,v_j)\in E(G)$ if and only if the paths $P_i$, $P_j$ contain the horizontal grid edge $((i,j), (i',j))$. Moreover, no paths share vertical grid edges. Therefore the vertices in the graph are adjacent if and only if the corresponding paths share a common grid edge.
%  $\square$ \end{prove}
 
 %Moreover, the same applies to EPG-Helly graphs. 
 
 De forma equivalente, também é possível mostrar que todo grafo possui uma representação EPG que satisfaz à propriedade Helly. Um algoritmo que efetua essa construção é apresentado no Lema~\ref{lem:todoGrafoEpgHelly}.
 
 \begin{lema}\label{lem:todoGrafoEpgHelly}
 Todo grafo é um grafo EPG-Helly.
 \end{lema}
%  \setcounter{prove}{1}
  \begin{proof}
  Seja $G$ um grafo com $n$ vértices $v_1, v_2, \dots, v_n$ e $\mu$ cliques maximais $C_1, C_2, \dots , C_{\mu }$. É possível construir uma representação EPG-Helly de $G$ usando uma grade $Q$ de tamanho $(\mu \times 2n)$. As linhas correspondem às cliques maximais e são enumeradas $1, 2, \dots , \mu$. Cada vértice $v_j$ corresponde ao par de colunas $j, j+n$. Cada clique maximal  $C_i$ é mapeada para uma aresta $(i,n), (i,n+1)$. %Cada caminho $P_j$ contém todas arestas $(i,n), (i,n+1)$ correspondendo às cliques maximais $C_i$ contendo $v_i$.
  
  %Além disso, dois caminhos distintos $P_j,P_k$ intersectam nas arestas correspondendo às cliques maximais contendo $v_j,v_k$.
  
  Tome $v_j \in V(G)$, considere a clique maximal contendo $v_j$ em ordem ascendente de seus índices. O caminho $P_j$ representando $v_j$, inicia no vértice $(1,j)$ de $Q$ e desce na coluna $j$ até $(i,j)$, onde $C_i$ é a primeira clique contendo $v_j$ então $P_j$ dobra no vértice  $(i,j)$ e prossegue para a direita, atravessa a aresta $(i,n), (i,n+1)$ representando $C_i$. Então $P_j$ prossegue  sobre a linha $i$ até atingir o vértice  $(i, j+n)$, onde dobra novamente, descendo na coluna $j+n$ até atingir o vértice $(l,j), l>i$, onde $C_l$ está a próxima clique maximal contendo  $v_j$ onde ele dobra mais uma vez. O caminho prossegue a linha $l$, atravessando a aresta $(l,n),(l,n+1)$, e assim por diante, até que todas as arestas de $Q$ correspondendo às cliques maximais contendo $v_j$ terem sido atravessadas por $P_j$.   
  
Segue então que dois caminhos distintos, $P_j$ e $P_q$, intersectam-se exatamente nas linhas correspondendo às cliques maximais contendo ambos $v_j$ e $v_q$.  
  \end{proof}
 
 A Figura~\ref{fig:gradeDemonstracao} apresenta a grade $Q$ e o caminho $P_2$ correspondendo ao vértice $v_2 \in V(G)$, contendo as cliques maximais  $C_2, C_4$ e $C_5$ de $G$.
 
  \input{./includes/include-img/grade.tex}
 
 
 
 \begin{corollary}
 Todo grafo $G$ contendo  $\mu$ cliques maximais admite uma representação $B_{2\mu -1}$-EPG-Helly. %in a grid $Q$ of dimension $(\mu \times 2n)$.
 \end{corollary}
 

%Note que a classe de grafos $B_0$-EPG coincide com a bem conhecida classe de grafos de intervalo, i.e. grafos de intersecção de intervalos sobre uma reta real. 


\begin {lema} \label{lem:b0epg}
Toda representação $ B_0$-EPG satisfaz à propriedade Helly.
\end {lema}

\begin{proof}
Segue diretamente da seguinte observação de \citeauthor{golumbic2009}~\cite{golumbic2009}: a classe de grafos $B_0$-EPG pode ser vista como a classe de grafos de intervalo, grafos de intersecção de intervalos sobre uma linha. Note que  intervalos sobre linhas distintas da grade, horizontais ou verticais, formam componentes distintas do grafo.
\end{proof}


% \begin {proof}
% Assuma por contradição que exista um grafo $G$ que admite uma representação $ B_0$-EPG que não satisfaz à propriedade Helly. Então, essa representação possui uma coleção minimal de caminhos mutuamente intersectantes $ \mathcal{P} = \{P_{1}, P_{2}, \ldots, P_{k} \} $ tal que $ P_{1} \cap P_{2} \cap \cdots \cap P_{k} = \emptyset, k \geq 3. $
% Por minimalidade, sabemos que  $ \bar{P_1} = \mathcal{P} \setminus \{P_1 \}$, $ \bar {P_2} = \mathcal{P} \setminus \{P_2 \} $ e $ \bar {P_3 } = \mathcal{P} \setminus \{P_3) \} $ são mutuamente intersectantes e satisfazem à propriedade Helly.
% Assim, existem os seguintes segmentos distintos $ s_{\bar{P_1}}, s_{\bar {P_2}}, s_{\bar {P_3}}$ associados com a intersecção de caminhos em $ \bar {P_1},  \bar {P_2} $ e $ \bar {P_3} $. Uma vez que a representação não possui caminhos com dobras, então sabemos que os caminhos em  $ \mathcal{P}$ estão sobre a mesma linha.
% Sem perda de generalidade, vamos assumir que  $ s_{ \bar {P_1}}, s_{ \bar {P_2}}$ e $ s_{ \bar {P_3}}$ ocorrem da esquerda para a direita nessa ordem. Uma vez que $ s_{\bar {P_3}}$ e $ s_{\bar {P_1}}$ intersectam $ P_2 $, e $ P_2 $ é um caminho sem dobra, então $ P_2$ intersecta $ s_{\bar {P_2}}$. Dessa forma temos uma contradição, pois $ s_{\bar {P_2}} $ intersecta todos os caminhos em $ \mathcal{P}$, contradizendo a hipótese de $ P_1 \cap P_2 \cap \cdots \cap P_k = \emptyset $.
% \end {proof}
%%%%%%%%%

\begin{corollary}
A classe $B_0$-EPG coincide com a classe $B_0$-EPG-Helly.
\end{corollary}

Grafos $B_0$-EPG coincidem com a classe de grafos de intervalo. O problema de reconhecimento de grafos de intervalo pode ser resolvido em tempo linear~\cite{booth1976}. Já o problema de reconhecimento de grafos $ B_1$-EPG é $NP$-completo \cite {heldt2014}. Em particular, os grafos $ B_1$-EPG-Helly formam uma subclasse propriamente contida em $ B_1$-EPG, ver a Figura~\ref{fig:diagramaEPG}. Além disso, a complexidade de reconhecimento da classe de grafos $ B_1$-EPG-Helly é um problema em aberto. Este trabalho se propõe a resolvê-lo.% que foi resolvido por este trabalho. 

%O Lema \ref{lem:octaedronaohelly} mostra que 
As classes  $ B_1$-EPG e $ B_1$-EPG-Helly são distintas, observe o grafo octaedro $ O_3$, ver Figura~\ref{fig:octaedro}(a), que apresenta uma representação  $B_1$-EPG minimal, a menos de isomorfismos, como na Figura~\ref{fig:octaedro}(b). O grafo octaedro  $ O_3 $ pertence a $ B_1$-EPG mas não pertence a $B_1$-EPG-Helly.

\input{./includes/include-img/diagramaEpg.tex}



\section{Representações $B_1$-EPG para os grafos $C_4$ e Octaedro}
%{The Classes $B_1$-EPG and $B_1$-EPG-Helly}

A seguir descrevemos quais são as representações de um grafo $C_4$ em uma representação de dobra simples. Uma descrição alternativa das possíveis representações de um $C_4$ pode ser encontrada em~\cite{golumbic2009}, onde o autor demonstra que são somente essas as poucas representações possíveis para o ciclo induzido de tamanho 4.


%By the results of \cite{golumbic2009}, in Lemma ~\ref{lem:representacaoC4}, every induced cycle of size 4 in a $ B_1$-EPG  representation  of $C_4$ has only a few possible representations.

\begin{definition} \label{defi:tortasFrame}

Seja $ Q $ uma grade e sejam $ (a_1, b),$ $(a_2, b),$ $(a_3, b),$ $(a_4, b)$ arestas que formam uma 4-estrela como retratado na Figura~\ref{fig:piesInGrid}(a). Seja  $ \mathcal{P} = \{P_1, \dots , P_4\}$ uma coleção de caminhos, cada um contendo exatamente duas arestas da $4$-estrela, definimos:

\begin{itemize}
\item Uma \emph{torta verdadeira} é uma representação onde cada caminho $P_i$ de $ \mathcal{P} $ forma uma dobra em $b$.

\item Uma \emph {torta falsa} é uma representação onde dois caminhos distintos $P_i, P_j$  não contém dobra, enquanto os dois caminhos restantes não compartilham aresta. 


%\input{./includes/include-img/recorteGrade.tex}
\input{./includes/include-img/pies.tex}

\end{itemize}
\end{definition}
%In both cases the point $b$ is called \emph{centro}, see Figures~\ref{fig:piesInGrid}(b) and~\ref{fig:piesInGrid}(c). There are edge-intersections $ (a_1, b), (a_2, b), (a_3, b), (a_4, b)$ called \emph{raio centrals}, see Figure~\ref{fig:piesInGrid}.

\begin{definition} \label{defi:tortasFrame2}
 Considere um retângulo de qualquer tamanho com os quatro cantos nos vértices  $ (x_1, y_1);$ $(x_2, y_1);$ $(x_2, y_2);$ $(x_1, y_2)$, posicionado como na Figura~\ref{fig:frameInGrid}. Uma \emph{moldura} é uma representação contendo os 4 caminhos de $\mathcal{P} =  \{ P_1, \dots, P_4\} $, cada um deles tendo uma dobra em um canto diferente do retângulo, e tal que os subcaminhos $ P_1 \cap P_2, P_2 \cap P_3, P_3 \cap P_4, P_4 \cap P_1 $, compartilham no mínimo uma aresta. Enquanto os subcaminhos  $ P_2 \cap P_4 $ e $ P_1 \cap P_3 $ não compartilham aresta.

\input{./includes/include-img/dispositionFrameInGrid.tex}
\end{definition}


%\input{./includes/include-img/ciclotam4.tex}


\begin{lema}\label{lem:representacaoC4}
\cite{golumbic2009} Todo $C_4$ que é um subgrafo induzido de um grafo $ G $ corresponde, em qualquer representação de dobra simples, a uma torta verdadeira, a uma torta falsa, ou a uma moldura.
\end{lema}
% \begin{prove} Consider a collection of paths $ P = \ {P_1, \dots, P_4}$ of a grid $ Q $ in a $ B_1$-EPG representation of the graph $G$.

% Consider $ C_4 = (v_1, v_2, v_3, v_4) $ that is a chordless 4-cycle in $ G$. Consider $P_i$ the path in $ G $ that corresponds to $v_i $.
% Suppose $ \displaystyle \bigcap _{P_i \in P} P_i \neq \emptyset $, then clearly $ \displaystyle \bigcap _{P_i \in P} P_i = {b} $, for some point $ b $ of the grid. Since each vertex in $ C_4 $ has exactly 2 neighbors, each path $ P_i $ contains exactly two edges of the grid with end point $ b$. Thus, we obtain a star subgraph with centro point $ b $ and edges $ (a_1, b), (a_2, b), (a_3, b), (a_4, b)$.
% Without loss of generality, $ P_1 $ contains the edges $ (a_1, b), (a_2, b) $ of the grid. If $ P_2 $ contains $ (a_2, b), (a_3, b) $ or $ (a_1, b), (a_4, b) $, then we get a torta verdadeira. Otherwise, $ P_2 $ contains the edges $ (a_2, b), (a_4, b) $ or $ (a_1, b), (a_3, b) $ and we obtain a torta falsa.

% Otherwise, $ \displaystyle \bigcaP_ {P_i \in P} P_i = \emptyset$. Suppose $ P_1 $ is a path without bend. Each of the $ P_2 $ and $ P_4 $ paths share an edge with $ P_1 $ but do not share a common edge with any other path. If $ P_2 $ and $ P_4 $ do not have a bend, then we get a interval representation of $ C_4 - v_3 $. However, it is not possible to add a $ P_3 $ path with at most of one bend. Similarly, if $ P_2 $ and $ P_4 $ have a single bend, the $ P_3 $ path can not be added either. Therefore, $ P_1 $ has a single bend.

% By symmetry, we assume that all $ P_i $ must has a single bend. Moreover, two paths can not have a bend on a common point in the grid. Thus, we obtain a rectangular subgraph with angles $ (x_1, y_1), (x_2, y_1), (x_2, y_2), (x_1, y_2) $, where $ P_1 $ bends at $ (x_1, y_1) $, $ P_2 $ bends at $ (x_2, y_1) $, $ P_3 $ bends at $ (x_2, y_2) $, and $ P_4 $ bends at $ (x_1, y_2) $, forming a frame.
% $\square$ \end{prove}

\begin{definition}
%A edge is \emph{unnecessary} if its removal keeps the intersections and not intersection of the representation. 
Uma representação $B_k$-EPG de um grafo $G$ é \emph{minimal} quando seu conjunto de arestas não contém propriamente outra representação $B_k$-EPG de $G$.
%when all unnecessary edges are removed.
\end{definition}

O grafo \textit{octaedro} é o grafo que contém  6 vértices e 12 arestas, retratado na  Figura~\ref{fig:octaedro}(a). A seguir, consideramos  representações do octaedro.

\begin{lema}\label{lem:octaedronaohelly}
O grafo octaedro  $O_3$ possui uma representação $ B_1$-EPG minimal única, a menos de isomorfismos.
\end{lema}
\begin{proof}
O grafo octaedro $ O_3 $ possui em sua constituição estrutural ciclos induzidos de tamanho  4 ($ C_4$'s). 
Tome um subgrafo $ C_4 $ qualquer do octaedro $ O_3$. O par de vértices não adjacentes do ciclo induzido são gêmeos falsos cuja vizinhança são os vértices pertencentes ao $C_4$ induzido. Cada vértice fora do $C_4$ é adjacente a todos os vértices do $C_4$. Assim quando a representação $ B_1$-EPG do $C_4$ é feita por  moldura, nenhum outro caminho da representação de dobra simples pode ser simultaneamente intersectante aos 4 caminhos da moldura. Portanto, concluímos que a estrutura moldura não pode ser parte de uma representação de dobra simples do grafo $ O_3$.

Com o mesmo raciocínio, tome uma representação $ B_1$-EPG de $C_4$ agora por torta verdadeira ou torta falsa. Quando adicionamos os caminhos correspondentes a vértices gêmeos falsos, de forma que sejam vizinhos a todos os vértices do $ C_4 $, obtemos $ O_3$, ambas representações convergem para a estrutura apresentada na Figura~\ref{fig:octaedro}(b). 
 \end{proof}

 \input{./includes/include-img/octaedro.tex}

Pelo Lema~\ref{lem:octaedronaohelly}, o grafo $ O_3 $ possui uma representação  $B_1$-EPG minimal única, a menos de isomorfismos, como retratado na Figura~\ref{fig:octaedro}(b). Como os caminhos $ P_a, P_b $ e $ P_c $  não satisfazem à propriedade Helly, então $O_3 \notin B_1$-EPG-Helly. 

\section{Pertinência a $\mathcal{NP}$}

%In this paper we are interested in characterizing the complexity of the $B_1$-EPG-Helly recognition problem, whose formal definition is presented next:
Nesta seção, mostraremos que o problema de reconhecimento de grafos $B_k$-EPG-Helly, onde $k$ é limitado por um polinômio de $|V(G)|$, pertence a  $\mathcal{NP}$. O problema pode ser formalmente descrito como segue.

\input{./includes/include-tab/reconhecimentob1epghelly.tex}

Um certificado (positivo) para o problema {\sc Reconhecimento $B_k$-EPG-Helly} consiste de uma grade $Q$, um conjunto de caminhos $\mathcal{P}$ com até $k$-dobras sobre $Q$, que tenham uma correspondência de um-para-um com os vértices do conjunto $V(G)$ de $G$, tais que, para cada par de caminhos distintos $P_i, P_j\in \mathcal{P}, P_i\cap P_j \neq \emptyset $  se e somente se os vértices correspondentes são adjacentes em $G$. Além disso, $\mathcal{P}$ deve satisfazer à propriedade Helly.

Os seguintes conceitos são centrais para nosso propósito.
Uma \emph{aresta relevante} em uma representação $B_k$-EPG é aquela que é aresta de extremidade ou uma aresta de dobra. Portanto, como cada caminho possui no máximo $k$ dobras, então cada caminho pode ter até $2(k+1)$ arestas relevantes, e qualquer representação $B_k$-EPG contém no máximo $2|\mathcal{P}|(k+1)$ arestas relevantes.

%O certificado para o algoritmo de verificação que mostra que um grafo é um grafo $B_k$-EPG-Helly possui como parâmetros de entrada uma representação $B_k$-EPG, chamemos de $R$, contendo uma coleção de caminhos $\mathcal{P}$, $|\mathcal{P}|=|V(G)|$, onde cada caminho  $P_i \in \mathcal{P}$ é dado pelo seu conjunto de arestas relevantes mais o conjunto de arestas relevantes, que intersectam   $P_i$, de outros caminhos. As arestas relevantes devem ser dadas na ordem em que aparecem no caminho. Esse formato de codificação para os caminhos nos permite verificar se cada conjunto de arestas relevantes realmente representa um caminho com no máximo $k$-dobras. Essa representação também é útil para verificar se as intersecções correspondem a um modelo de intersecção para $G$.

%Um certificado (positivo) para  {\sc Reconhecimento $B_k$-EPG-Helly} consiste de uma grade $Q$, um conjunto  $\mathcal{P}$ de caminhos com $k$-dobras sobre $Q$, which have a one-to-one correspondence with the vertex set $V(G)$ of $G$, such that, for each pair of distinct paths $P_i, P_j\in \mathcal{P}, P_i\cap P_j \neq \emptyset $ if and only if the corresponding vertices are adjacent in $G$. Furthermore, $\mathcal{P}$ satisfies the Helly property.


Para mostrar que existe um algoritmo de tempo polinomial não determinístico para {\sc Reconhecimento $B_k$-EPG-Helly}, é suficiente considerar como certificado uma representação $B_k$-EPG, digamos  $R$, contendo uma coleção de caminhos  $\mathcal{P}$, onde $|\mathcal{P}| = |V(G)|$, tal que cada caminho   $P_i \in \mathcal{P}$  é dado pelo seu conjunto de arestas relevantes juntamente com o conjunto de todas as arestas relevantes de $P_j$ que intersectam $P_i$, onde $P_j \in \mathcal{P}$.  % as arestas relevantes, que intersectam $P_i$, de cada caminho $P_j$ que intersecta  $P_i$, onde $P_j \in \mathcal{P}$. 
 As arestas relevantes para cada caminho são dadas na ordem em que elas aparecem no caminho, de forma que é fácil checar se as arestas correspondem a um caminho único com no máximo  $k$ dobras. Essa representação é também utilizada para checar se os caminhos formam um modelo de intersecção para  $G$.

A fim de verificar, em tempo polinomial, que a entrada de fato é um certificado para o problema, temos que verificar as seguintes afirmações:

\begin{enumerate}[label=(\roman*)]
\item A sequência de arestas relevantes de um caminho $P_i\in \mathcal{P}$ determina unicamente $P_i$ em tempo polinomial; \label{it:bullet1}

\item Dois caminhos  $P_i, P_j \in \mathcal{P}$ são intersectantes se e somente se eles se intersectam em alguma aresta relevante; \label{it:bullet2}

\item O conjunto  $\mathcal{P}$ de arestas relevantes satisfaz à propriedade Helly. \label{it:bullet3}
\end{enumerate}

O Lema a seguir mostra que a condição~\ref{it:bullet1} é válida.

\begin{lema}\label{lem:verify1}
Cada caminho $P_i$ pode ser determinado unicamente, em tempo polinomial pela sua sequência de arestas relevantes.
\end{lema}

\begin{proof}
É fácil verificar que o item~\ref{it:bullet1} é verdadeiro. Considere a sequência de arestas relevantes de algum caminho $P_i\in \mathcal{P}$. Inicie de uma aresta de extremidade de $P_i$. Seja   $t$ a linha (coluna) contendo a última aresta relevante considerada. A próxima aresta relevante  $e'$ na sequência, deve estar contida na linha (coluna) $t$. Se $e'$ é uma aresta de extremidade, o processo está terminado e o caminho terá sido determinado. Ele contém todas arestas entre as arestas relevantes consideradas na sequência.  Caso contrário, se  $e'$ é uma aresta de dobra, a próxima aresta relevante é é a segunda aresta de dobra  $e''$ da mesma dobra, que está contida em alguma coluna (linha) $t'$. O processo continua até que a segunda aresta de extremidade de $P_i$ estar localizada.   

Com o procedimento acima podemos determinar em tempo $\mathcal{O}(k\cdot |V(G)|)$, se o caminho $P_i$ contém qualquer dada aresta da grade $Q$. Além disso, a sequência de arestas relevantes de  $P_i$ determina unicamente  $P_i$.
 \end{proof} %$\square$

O lema abaixo mostra que o item~\ref{it:bullet2} é válido.

\begin{lema}\label{lem:relevantEdges}
Seja $\mathcal{P}$ o conjunto de caminhos em uma representação $B_k$-EPG $R$ de $G$, e sejam $P_1,P_2 \in \mathcal{P}$. Então $P_1, P_2$ são caminhos intersectantes se e somente se sua intersecção contém no mínimo uma aresta relevante.%eles contêm no mínimo uma aresta relevante em comum.
\end{lema}

\begin{proof}
Se $P_1, P_2$ contém uma aresta relevante comum então claramente eles são intersectantes. Caso contrário, considere que $P_1, P_2$ são intersectantes, e mostraremos que eles contêm uma aresta relevante comum. Sem perda de generalidade, suponha que $P_1, P_2$ intersectam-se na linha \textit{i} da grade, em uma representação   $B_k$-EPG, digamos $R$. As seguintes são as possibilidades que podem ocorrer. 

Seja $e$ uma aresta comum a $P_1$ e $P_2$. Se $e$ não é aresta relevante, então a aresta seguinte à  esquerda (ou direita) de $e$, digamos $e'$, também pertence a $P_1 \cap P_2$. Tome $e'$, se $e'$ é relevante, então encontramos a aresta relevante da intersecção de $P_1$ e $P_2$, se não repetimos o processo até que uma aresta relevante seja encontrada. Caso os caminhos sejam juntos, uma aresta de dobra ou de extremidade é comum aos dois. Caso os dois caminhos se separem em algum ponto também existe uma aresta de dobra ou de extremidade que é comum aos dois.

% \begin{itemize}
% \item \textbf{Caso 1:} Nem $P_1$ nem $P_2$ contêm dobras na linha \textit{i}. 

% Então $P_1$ e $ P_2$  estão inteiramente contidos na linha \textit{i}. Uma vez que eles se intersectam, ou  $P_1, P_2$  se cobrem parcialmente, ou um dos caminhos contém o outro. Em qualquer dessas situações eles intersectam em uma aresta de extremidade comum, que é uma aresta relevante.

% \item \textbf{Caso 2:} $P_1$ não contém dobras em \textit{i}, mas $ P_2$ contém.

% Se alguma aresta de dobra de $P_2$ também pertence a   $P_1$, então $P_1, P_2$  intersectam-se em uma aresta relevante. Caso contrário, uma vez que $P_1, P_2$  intersectam-se, a única possibilidade é que a intersecção contenha uma aresta de extremidade de  $P_1$ ou $ P_2$. Portanto, os caminhos se intersectam em uma aresta relevante.

% \item \textbf{Caso 3:} Ambos $P_1$,  $P_2$ contém em \textit{i}.

% Novamente, se a intersecção ocorre em alguma aresta de dobra de $P_1$  ou $P_2$, o lema segue válido. Caso contrário,  a mesma situação anterior deve ocorrer, ou seja, $P_1, P_2$  devem intersectar em alguma aresta de extremidade.
 
% \end{itemize}
Em qualquer dos casos, $P_1$ e $P_2$ intersectam-se em alguma aresta relevante.
\end{proof}

Os dois lemas anteriores nos permitem checar que um certificado é uma representação $B_k$-EPG correta de um dado grafo $G$. O próximo lema diz que podemos verificar em tempo polinomial que a representação codificada em um certificado é uma representação Helly. Felizmente nós não precisamos checar todos os subconjuntos de caminhos intersectantes da representação para ter certeza que eles possuem uma intersecção comum.

Finalmente, provamos o item~\ref{it:bullet3}.


\begin{lema}\label{lem:verify3}
Seja $\mathcal{P}$ uma coleção de caminhos codificados como uma sequência de arestas relevantes que constituem uma representação $B_k$-EPG  de um grafo  $G$. Podemos verificar em tempo polinomial se $\mathcal{P}$  possui a propriedade Helly.
\end{lema}


\begin{proof}
Seja $\mathcal{T}$ o conjunto de arestas relevantes de $\mathcal{P}$. Consideramos cada tripla $T_i$ de arestas de  $\mathcal{T}$. Seja $\mathcal{P}_i$ o conjunto de caminhos de  $\mathcal{P}$ contendo no mínimo duas arestas relevantes de $T_i$. Pelo Teorema de Gilmore~\cite{bergeDuchet1975}, $\mathcal{P}$ possui a propriedade Helly se e somente se o subconjunto de caminhos de $\mathcal{P}_i$ correspondendo a cada tripla de $T_i$ tem intersecção não vazia.  Pelo Lema~\ref{lem:relevantEdges} é suficiente examinar a intersecção das arestas relevantes.  Além disso, um algoritmo polinomial para checar se $\mathcal{P}$ possui a propriedade Helly poderia examinar cada um dos subconjuntos $P_i$, e para cada aresta relevante $e$ de um caminho em $P_i$, computar o número de caminhos em $P_i$ que contêm $e$. $\mathcal{P}$ tem a propriedade Helly se e somente se para cada $P_i$ existe alguma aresta relevante que está em todos os caminhos de $P_i$ produzindo uma intersecção não vazia.
 \end{proof} %$\square$


\begin{corollary}\label{cor:comumAtodos}
Seja ${\mathcal P'}$ um conjunto mutuamente intersectante de caminhos em uma representação $B_k$-EPG-Helly de um grafo  $G$. Então a intersecção de todos os caminhos de ${\mathcal P'}$ contém no mínimo uma aresta relevante.
\end{corollary}

Note que a propriedade descrita no Corolário~\ref{cor:comumAtodos} é devida ao Teorema de Gilmore~\cite{bergeDuchet1975}, e se aplica somente a representações que satisfazem à propriedade Helly.

\medskip


\begin{lemma}\label{lem:gridPolinomial}
Seja $G$ um grafo $B_k$-EPG-Helly. Então $G$ admite uma representação $B_k$-EPG-Helly sobre uma grade de tamanho que é no máximo $4n(k+1) \times 4n(k+1)$.
\end{lemma}
\begin{proof}
Seja $R$ uma representação $B_k$-EPG de um grafo $G$ sobre uma grade $Q$ com o menor tamanho possível.
Seja $\mathcal{P}$ o conjunto de caminhos de  $R$. Note que $|\mathcal{P}|=n$.
 Existem no máximo $2|\mathcal{P}|(k+1)$ arestas relevantes em  $R$. 
 Se $Q$ possui um par de colunas consecutivas $c_i,c_{i+1}$ que não contém arestas relevantes de  $R$, e tais que não existem arestas relevantes cruzando de $c_i$ para $c_{i+1}$, então podemos contrair cada aresta cruzando de $c_i$ para $c_{i+1}$ em um único vértice de forma a obter uma nova representação  $B_k$-EPG  $G$ sobre uma grade de menor tamanho, o que é uma contradição. Um argumento análogo pode ser aplicado a pares de linhas consecutivas da grade.
  Portanto, a grade  $Q$ é tal que cada par de colunas consecutivas e de linhas consecutivas de  $Q$ tem no mínimo uma aresta relevante de $R$ ou contém uma aresta relevante cruzando-as.  
  Como $Q$ é a menor grade possível para representar  $G$ então a primeira linha e a primeira coluna de $Q$ ambas devem conter no mínimo um ponto  pertencendo a alguma aresta relevante de $R$. 
Assim, se $G$ é $B_k$-EPG então ele admite uma  representação $B_k$-EPG sobre uma grade de tamanho no máximo $4|\mathcal{P}|(k+1) \times 4|\mathcal{P}|(k+1)$.
Além do mais, pelo  Corolário~\ref{cor:comumAtodos}, sustenta-se que a operação de contração anteriormente descrita preserva à propriedade Helly, se houver. Assim, sendo $R$ uma representação $B_k$-EPG-Helly de um grafo $G$ sobre uma grade $Q$ com tamanho mínimo possível, é seguro afirmar que $Q$ possui tamanho no máximo  $4|\mathcal{P}|(k+1) \times 4|\mathcal{P}|(k+1)$.
\end{proof}

\begin{theorem}\label{teo:nppertinencia}
{\sc Reconhecimento $B_k$-EPG-Helly} está em  $\mathcal{NP}$, sempre que $k$ é limitado por uma função polinomial de $|V(G)|$.
\end{theorem}
\begin{proof}
Pelo Lema~\ref{lem:gridPolinomial} e o fato de que $k$ é limitado por uma função polinomial de  $|V(G)|$, segue que a coleção  $\mathcal{P}$ pode ser codificada através de suas arestas relevantes com   $n^{\mathcal{O}(1)}$ bits.

Finalmente, pelos Lemas~\ref{lem:verify1}, \ref{lem:relevantEdges} e \ref{lem:verify3}, segue que podemos verificar em tempo polinomial sobre o tamanho de $G$ se $\mathcal{P}$ é uma família de conjuntos codificada como uma sequência de arestas relevantes que constituem uma representação $B_k$-EPG-Helly de um grafo  $G$.
\end{proof}

\section{$NP$-Dificuldade}\label{sec:sectionDispositivoClausula}

Agora provaremos que o reconhecimento de grafos   $B_1$-EPG-Helly é $NP$-completo. Para essa demonstração seguiremos o roteiro de prova de dificuldade traçado por~\cite{heldt2014}.  Estabelecemos a redução do problema {\sc Positive (1 in 3)-3SAT} definido como segue:

\input{./includes/include-tab/1em33sat.tex}

{\sc Positive (1 in 3)-3SAT } é um problema $NP$-completo bem conhecido (ver \cite{johnson1979}, problema [L04], pág. 259). {\sc Positive (1 in 3)-3SAT} permanece $NP$-completo quando o grafo de incidência da fórmula CNF (Conjunctive Normal Form) é um grafo planar~\cite{mulzer2008minimum}.

Dada uma fórmula  $F$ que é uma instância de {\sc Positive (1 in 3)-3SAT} apresentaremos uma construção de tempo polinomial de um grafo $ G_F$ tal que  $ G_F $ é $ B_1$-EPG-Helly se e somente se $ F $ é satisfativa. Esse grafo conterá um subgrafo induzido  $ G_{c_i}$ com 12 vértices (chamado \emph {dispositivo cláusula}) para toda cláusula $C_i \in F$, e um subgrafo induzido (\emph {dispositivo variável}) para cada variável $ x_j$, contendo um vértice especial   $ v_j$, além de um  \emph{dispositivo base}  com 55 vértices adicionais.

%Since a Sun graph $S_4$ whose centro is a cycle of size 4 and adding a false twin to each vertex of $S_4$ that is not a member of central induced cycle then we have the graph $H$. 
Utilizaremos um grafo $H$ isomorfo ao grafo ilustrado na Figura~\ref{fig:gadgetBase}, como um  dispositivo para realizar a prova. Para cada cláusula  $C_i$ de $F$ do nosso problema alvo, teremos um \emph{dispositivo cláusula} isomorfo a $H$, denotado por $G_{C_i}$. %The graph $H$ consists of subgraphs whose $B_1$-EPG representations are well known, such as: cycles of sizes 3 and 4.

\input{./includes/include-img/gadgetB1EpgHelly.tex} 

%\subsection{Definition}\label{sec:reducao}%The problem reduction}

A redução  de uma instância $F$ de  {\sc Positive (1 in 3)-3SAT}  para um grafo particular $G_F$ tal que $G_F$ possui uma representação $B_{1}$-EPG-Helly se e somente se $F$ é satisfatível, é dada abaixo.

\begin{definition}\label{sec:reducao}
Seja $F$ uma fórmula na CNF sem literais negativos, em que toda cláusula possui exatamente três literais. O grafo $G_F$ é construído como segue:

\begin{enumerate}
\item Para cada cláusula $C_i \in F$ criar um \textit{dispositivo cláusula} $G_{C_i}$, isomorfo ao grafo $H$;

\item Para cada variável $x_{j}$ criar um \emph{vértice-variável} $v_{j}$ que é adjacente aos vértices $a$, $e,$ ou $h$ de $G_{C_i}$, quando $x_{j}$ é a primeira, segunda ou terceira variável em $C_i$, respectivamente;

\item Para cada vértice-variável $v_{j}$, construir um \emph{dispositivo variável} formado pela adição de duas cópias de  $H$, digamos $H_1$ e $H_2$, e fazendo $v_j$ adjacente aos vértices do triângulo $(a, b, c)$ em  $H_1$ e $H_2$.

 %where $v_{j}$ is  adjacent to all vertices of the triangle (a,b,c);%; (c,e,g); (g,f,h); or (b,d,f)) of each $H_1$ and $H_2$; 

%\item The  subgraph induced by \emph{vértice-variável}  $v_{j}$, and also $V(H_1)$ and $V(H_2)$ will be called \emph{dispositivo variável}; 

\item Criar um vértice $V$, que será utilizado como referência vertical para a construção, e adicionar arestas de  $V$ para cada vértice  $d$ nos \emph{dispositivos cláusula};%$d \in V(G_c)$;

\item Criar um grafo bipartido $K_{2,4}$ com um vértice particular $T$ que faz parte do maior conjunto estável desse $K_{2,4}$. Esse vértice é denominado \emph{vértice-verdadeiro}. $T$ é adjacente a todos  $v_{j}$ e também a $V$;

\item Criar dois grafos isomorfos a $H$, digamos $G_{B1}$ e $G_{B2}$. O vértice $T$ é conectado a todos os vértices do triângulo $(a,b,c)$
em $G_{B1}$ e $G_{B2}$;


\item Criar dois grafos isomorfos a $H$, digamos $G_{B3}$ e $G_{B4}$. O vértice $V$ está conectado a todos os vértices do triângulo $(a,b,c)$ em $G_{B3}$ e $G_{B4}$;

\item O subgrafo induzido pelo conjunto de vértices $\{V(K_{2,4}) \cup  \{T, V\} \cup V(G_{B1}) \cup V(G_{B2}) \cup V(G_{B3}) \cup V(G_{B4})\}$ será denominado como \emph{dispositivo base}. 
\end{enumerate}
\end{definition}


A Figura~\ref{fig:exemploGrafoGF} retrata como essa construção funciona quando aplicada sobre uma pequena fórmula. %represents the graph that would be obtained when the previous construction is applied to the formula $ F = (x_1 + x_2 + x_3) \wedge (x_2 + x_3 + x_4) \wedge (x_3 + x_1 + x_4)$.


\input{./includes/include-img/exemploGrafoGF.tex}


\begin{lema}\label{lem:ida}
Dada uma instância satisfatível $F$ de {\sc Positive (1 in 3)-3SAT}, o grafo  $G_F$ construído a partir de $F$ de acordo com a Definição~\ref{sec:reducao} admite uma representação $B_{1}$-EPG-Helly.
\end{lema}


\begin{proof}

%~\ref{fig:representacaoCaminhos}
Utilizaremos as estruturas  torta verdadeira e torta falsa para representar os  \textit{dispositivo cláusula} $ G_C$, mas a construção poderia ser feita com a estrutura moldura sem perda de generalidade, ver Figura~\ref{fig:falseAndTruePie}.  


\input{./includes/include-img/falseAndTruePie.tex}

Os \textit{dispositivo variável} serão representados por estruturas como da Figura~\ref{fig:gadgetVariavel}.

\input{./includes/include-img/gadgetVariavel.tex}


O \textit{dispositivo base} será representado pela estrutura retratada na  Figura~\ref{fig:gadgetBaseSingleBend}.

\input{./includes/include-img/gadgetBase.tex}

É fácil ver que as representações dos dispositivo cláusula, dispositivo variável e dispositivo base são todas  $B_1$-EPG-Helly. Agora precisamos descrever como essas representações podem ser combinadas de forma a construir uma representação  de dobra simples $R_{G_F}$.

Dada uma atribuição  $A$ que satisfaz  $F$, podemos construir uma representação $R_{G_F}$ que seja  $B_{1}$-EPG-Helly. Primeiro, fixaremos a estrutura de representação do dispositivo base na grade para organizar a representação, ver Figura~\ref{fig:gadgetBaseSingleBend}. A seguir inserimos o  dispositivo variável com a seguinte regra: se a variável $x_i$ relacionada ao caminho   $P_{v_i}$ tiver atribuição  \textit{True}, então a adjacência entre o caminho $P_{v_i}$ com $P_{T}$ é horizontal, e vertical caso contrário. Por exemplo, uma atribuição  $A=\{x_1=False; x_2=False;x_3=True; x_4=False\}$  para as variáveis da fórmula  $F$ que gerou o dispositivo $G_F$ da Figura~\ref{fig:exemploGrafoGF}, nos dará um representação de dobra simples (dispositivo base + dispositivo variável) de acordo com a  Figura~\ref{fig:gadgetBasePlusVariables}(a). 

Quando a fórmula  $F$ de {\sc Positive (1-in-3)-3sat} possui cláusulas cujo formato de atribuição é $(False, True, False)$ ou $(False, False, True)$ então usaremos torta falsa para representar essas cláusulas, mas quando a cláusula tem formato  $(True, False, False)$ utilizaremos  torta verdadeira para representar essa cláusula. Para inserir um  \textit{ dispositivo cláusula} $G_{C_i}$, introduziremos uma linha horizontal $l_{h}$ na grade entre as linhas horizontais usadas pelos caminhos para as duas variáveis $False$ em $ C_i $. Então conectaremos o caminho $P_{d_{c_i}}$ de $G_{C_i}$ em $P_{V}$ verticalmente usando a dobra de  $P_{d_{c_i}}$. No entanto, introduziremos uma linha vertical $ l_{v}$, na grade, entre a linha vertical da grade usada por $P_{V}$ e o caminho para  a variável $True$ em $C_i$, i.e. entre $P_{V}$ e o caminho representando a variável  $x_j \in C_i$. Onde  $l_{h}$  e $l_{v}$ cruzarem, nesse ponto iremos inserir o centro do  \textit{dispositivo cláusula} como pode ser visto na Figura~\ref{fig:gadgetOnePie}(b). Uma construção completa dessa representação de dobra simples para  $G_F$ pode ser verificada na 
Figura~\ref{fig:gadgetFormulaCompletaPies}.%~\ref{fig:clausulagadgetgf}. 

\begin{landscape}
\input{./includes/include-img/gadgetBasePlusVariables.tex}
\end{landscape}


\input{./includes/include-img/gadgetFormulaCompletaPies.tex}


Note que quando juntamos todas essas representações  dos  dispositivos que formam $ R_{G_F} $ não há inserção de mais dobras nos caminhos que já possuíam dobra, então a representação necessariamente permanece sendo uma representação  $ B_1$-EPG válida. Nos resta mostrar que ela satisfaz à propriedade Helly. 

Uma forma simples de verificar que $ R_{G_F} $ satisfaz à propriedade Helly é notar que o grafo particular  $G_F$ nunca forma triângulos entre dispositivo variável, cláusula e base. Assim, qualquer triângulo de  $G_F$ está contido nos dispositivo variável, cláusula ou base. Como usamos somente representações  $B_1$-EPG-Helly desses dispositivos, $ R_{G_F} $ permanece uma representação $B_1$-EPG-Helly de $G_F$.
 \end{proof}

%\cleardoublepage
%\newpage

A seguir consideramos a conversão. Tome uma representação $B_1$-EPG-Helly, $R$ de $G_F$.

%To complete the proof of $NP$-hardness we will  present some considerations related with the single bend representation of gadgets that form the graph $G_F$. The way all gadgets can be drawn makes it possible to recover the formula that generated $G_F$ and a $True-$assignment for it. The following proofs help us understand the construction of a representation to $G_F$.  

\begin{definition}
Seja $H$ o grafo mostrado na  Figura~\ref{fig:gadgetBase}, tal que um 4-ciclo $H[\{b, c, f, g \}]$ corresponde em $R$ a uma estrutura de torta falsa ou torta verdadeira, então:

\begin{itemize}
\item O \emph{centro} é o único ponto da grade dessa representação que está contido em todo caminho representando o 4-ciclo $ \{b, c, f, g \}$; \label{lab:lab1}

\item Um \emph {raio central} é uma aresta-intersecção entre dois dos caminhos correspondendo aos vértices $ b, c, f, g$, respectivamente.
\end{itemize}
\end{definition}


Note que toda representação $B_1$-EPG de um $C_4$ satisfaz à propriedade Helly, ver Lema~\ref{lem:representacaoC4}, e os triângulos possuem $B_1$-EPG representações que satisfazem à propriedade Helly, e.g. a retratada na Figura~\ref{fig:trianguloepgRepresentacao}(b). O grafo $H$ é composto por um 4-ciclo,  $C_4^{H}=H[b, c, f, g]$ e oito triângulos, que são $(a,b,c);$ $(b,c,bc);$ $(c,e,g);$ $(c,g,cg);$ $(f,g,h);$ $(f,g,fg);$ $(b,d,f);$ $(b,f,bf).$

Como $C_4^{H}$ é um grafo que possui representações bem conhecidas (ver Lema~\ref{lem:representacaoC4}), então podemos iniciar o desenho da representação $B_{1}$-EPG-Helly de $H$ dessas estruturas. As  Figuras~\ref{fig:falsepietruepieframe} retratam possibilidades de representações para $H$.

Se um $C_4^{H}$ é representado por torta verdadeira ou torta falsa, então os caminhos $P_b, P_c, P_f, P_g$ compartilham um ponto central da representação. Por outro lado, se  $C_4^{H}$ é representado por uma moldura então as dobras dos caminhos correspondem aos quatro cantos distintos de um retângulo, i.e. todos os caminhos representando  vértices de um $C_4^{H}$ possuem pontos de dobra distintos, ver~\cite{golumbic2009}.

A seguir examinaremos o uso da estrutura moldura.

%Due asymmetric representations, the moldura structure needs to be studied in more detail. Next we will show some constraints of this structure. % in which allow us to consider it. %as gadget in the demonstration.

\begin{proposition}\label{lem:direcoesdiferentes}
Em uma representação $B_1$-EPG de um $C_4$ isomorfa a uma moldura, todo caminho  $P_i$ que representa um vértice do $C_4$ intersecta exatamente dois outros caminhos $P_{i-1}$ e $P_{i+1}$ da moldura, de modo que uma das intersecções é vertical e a outra é horizontal. %where one of them is vertical and another is a horizontal intersection.
\end{proposition}

\begin{proof}
A prova é imediata, pela definição de moldura.
 \end{proof}

\begin{proposition}\label{lem:mesmaretasuporte}
Dada uma representação $B_1$-EPG-Helly de um grafo $G$ que possui um $C_4$ induzido cuja representação é isomorfa a uma moldura. Se existe um vértice $v$ de $G$, fora desse $C_4$, que é adjacente a exatamente dois vértices consecutivos desse $C_4$, então o caminho representado por  $v$ possui uma aresta comum com os caminhos representando ambos vértices do $C_4$.% of $v$ into such .  
\end{proposition}

\begin{proof}
Por suposição, $G$ possui um triângulo contendo  $v$ e dois vértices de um $C_4$ representado por moldura. Além disso, o caminho representando  $v$ compartilha no mínimo uma aresta que é intersectante aos caminhos que representam seus vizinhos, caso contrário a representação não satisfaz à propriedade Helly.
 \end{proof}

%\cleardoublepage

Pela Proposição~\ref{lem:direcoesdiferentes} e Proposição~\ref{lem:mesmaretasuporte} podemos concluir que para todo vértice   $v_i \in V(H)$ tal que $v_i \neq V(C_4^{H})$, quando usamos uma moldura para representar o $C_4^{H}$, $P_{v_i}$ terá no mínimo uma aresta-intersecção comum ao par de caminhos representando seus vértices vizinhos em $H$. 
A Figura~\ref{fig:falsepietruepieframe}(c) retrata uma possível representação $B_{1}$-EPG-Helly de $H$. 
Note que ao aplicarmos operações de rotação e espelhamento, mantemos a representação $B_1$-EPG-Helly de $H$.
%On this $B_{1}$-EPG-Helly representation presented we can apply rotation and mirroring operations, because these operations do not change the structure. We can also a change the direction of the bend (see Figure~\ref{fig:falsepietruepieframe}(c) and Figure~\ref{fig:outraRepresentacaoFrame}), but also adjust other paths if needed, so as to not change the intersections between the paths.

\begin{definition}
Em uma representação de dobra simples de um grafo  $C_4$ isomorfo a uma moldura, os caminhos representando vértices consecutivos no  $C_4$ são chamados \emph{caminhos consecutivos} e o segmento que corresponde à intersecção entre dois caminhos consecutivos é chamado \emph{intersecção de lado}.  
\end{definition}

\begin{lema}\label{lem:2vertical2horizontal}
Em qualquer representação minimal de dobra simples de um grafo isomorfo a $H$, existem dois caminhos em   $\{P_a, P_e, P_d, P_h \}$ que tem direção horizontal e os outros dois caminhos possuem direção vertical.
\end{lema}

\begin{proof}
Se o $C_4^{H} = [b,c,f,g]$ é representado por uma torta verdadeira ou torta falsa então cada caminho do  $C_4^{H}$ compartilha dois raios centrais com dois outros caminhos do  $C_4^{H}$, onde cada raio central corresponde a um par de vértices consecutivos no $C_4^{H}$.

Como os vértices  $a, e, d, h$ são adjacentes a pares de vértices consecutivos no $C_4^{H}$ então os caminhos $P_a, P_e, P_d, P_h$ tem que se posicionar em cada um dos diferentes raios centrais,  2 estão na direção horizontal e 2 estão na direção vertical.

Se o $C_4^{H}$ é representado por uma moldura então cada caminho do $C_4^{H}$ possui uma dobra posicionada em uma curva da moldura. Na moldura, o relacionamento de adjacência de pares de vértices consecutivos no $C_4^{H}$ é representado pela intersecção dos caminhos que constituem a moldura. Assim, como uma moldura possui duas partes da direção vertical e duas partes na direção horizontal, então existem dois caminhos em $\{P_a, P_e, P_d, P_h\}$ que possuem direção vertical e dois caminhos que possuem direção horizontal.
 \end{proof}

\begin{corollary}
 \label{coro:paresMesmoSegmento}
Em qualquer representação minimal de dobra simples de um grafo isomorfo a $H$, os seguintes caminhos estão sobre o mesmo raio central ou intersecção de lado: %$P_a$ and $p(bc)$; $p(e)$ and $p(cg)$; $p(h)$ and $p(fg)$; $p(d)$ and $p(bf)$.

\begin{itemize}
\item $P_a$ e $P_{bc}$;
\item $P_e$ e $P_{cg}$;
\item $P_h$ e $P_{fg}$;
\item $P_d$ e $P_{bf}$.
\end{itemize}
\end{corollary}

\input{./includes/include-img/representacoesB1EpgHellyBase.tex}

\input{./includes/include-img/outraRepresentacaoFrame.tex}

\begin{definition}
Considere um grafo $G$ e um vértice $v \in V(G)$. Se em uma representação $B_1$-EPG de $G$ as duas arestas de dobra (ou uma aresta de extremidade) do caminho $P_v$ intersecta outros caminhos, então dizemos que  $P_v$ possui uma \emph{dobra obstruída (ou extremidade obstruída)}. 
Além do mais, dada uma representação $B_1$-EPG de $G$ onde $P_v$ possui uma dobra (ou extremidade) obstruída, dizemos que um subconjunto de caminhos \emph{obstrui} uma aresta de dobra (ou uma aresta de extremidade) de  $P_v$ se eles intersectam essa aresta. 
\end{definition}


\begin{fac} \label{fact:k24facts}
Em toda representação de dobra simples de um $K_{2,4}$, o caminho representando cada vértice do maior conjunto estável tem dobra em uma  torta falsa (ver mais em~\cite{Asinowski2009} e~\cite{daniel2014b}).
\end{fac}


\begin{lema}\label{lem:obstrucao}
Em qualquer representação de dobra simples do grafo  $G'$ retratado na  Figura~\ref{fig:extremidadeDobraObstruida}(a), o caminho $P_x$ possui extremidades e dobra obstruídos.
\end{lema}

\begin{proof}
Considere $G'$ consistindo de um vértice $x$, dois grafos isomorfos a  $H$, digamos $ H_1 $ e $ H_2 $, e um grafo bipartido $K_{2,4}$, tal que: $x$ é vértice do maior conjunto estável de $K_{2,4}$; $x$ é adjacente a um ciclo induzido de tamanho 3 de $H_1$, digamos $C_3^{H_1}$, e a um ciclo induzido de tamanho  3 de $H_2$, digamos $ C_3^{H_2}$, ver Figura~\ref{fig:extremidadeDobraObstruida}(a).

Sabemos que os caminhos pertencentes ao maior conjunto estável de um $K_{2,4}$ sempre dobram em uma  torta falsa, ver Fato~\ref{fact:k24facts}. Além disso $P_x$ é parte do maior conjunto estável desse  $K_{2,4}$, então $P_x$ possui uma \emph {dobra obstruída}, ver Figura~\ref{fig:extremidadeDobraObstruida}(b). 

O vértice  $x$ é adjacente ao $ C_{3}^{H_1}$ e ao $ C_3^{H_2}$, dessa forma o caminho $ P_x $ intersecta os caminhos representando eles. Mas em representações de dobra simples de um grafo isomorfo a $H$ existem pares de caminhos que sempre estão sobre o mesmo segmento de um raio central ou de uma intersecção de lado, ver o Corolário~\ref{coro:paresMesmoSegmento}, e a representação de  $C_{3}^{H_1}$ (similarmente para $C_3^{H_2})$ possui um desses caminhos. Todavia, existe uma aresta no conjunto de caminhos que representam  ${H_1}$ (similarmente em ${H_2}$) que tem uma intersecção de   3 caminhos representando $ C_{3}^{H_1}$ (e $ C_3^{H_2}$), caso contrário a representação não seria Helly, e existe  uma outra aresta distinta no mesmo  raio central ou intersecção de lado que é intersectada por três outros caminhos diferentes onde pelo menos um deles é diferentes dos caminhos correspondentes a $C_{3}^{H_1}$ (similarmente $C_3^{H_2}$). Assim, em uma representação de dobra simples de  $G'$, os caminhos que representam  $C_{3}^{H_1}$ (similarmente $C_3^{H_2})$ devem intersectar uma aresta de dobra ou uma aresta de extremidade de $P_x$, porque $P_x$ intersecta somente um dos conjuntos de caminhos que estão sobre o mesmo raio central ou intersecção de lado onde  $C_{3}^{H_1}$ (similarmente $C_3^{H_2})$ está. Como a dobra de   $P_x$ já está obstruída pelo restante da estrutura de $K_{2,4}$, então ${H_1}$ (similarmente ${H_2}$) deve estar posicionado na aresta de extremidade de  $P_x$. Isso implica que  $ P_x $ possui uma condição de \emph{extremidades obstruídas} e \emph{dobra obstruída}, ver Figura~\ref{fig:extremidadeDobraObstruida}(b).
\input{./includes/include-img/extremidadeDobraObstruida.tex}
\end{proof}




\begin{definition}
Dizemos que um segmento $s$ está \emph{internamente contido} em um caminho $P_x$ se $s$ está contido em $P_x$, e ele não intersecta uma aresta relevante de  $P_x$. 
\end{definition}

% \begin{fac}
% In a single bend representation of a graph, if a path $p(y)$ has an obstructed bend and obstructed extremities, and some path $p(x)$ intersects $p(y)$, but does not intersect paths that obstruct the extremities and the bend edges of $p(y)$, then the intersection between $p(x)$ and $p(y)$ isinternamente contida into $p(y)$. 
% \end{fac}


\begin{lema}\label{lem:volta}
Se um grafo $G_F$, construído de acordo com a definição  Definição~\ref{sec:reducao}, admite uma representação $B_1$-EPG-Helly, então a CNF-fórmula $F$ associada é uma instância-sim de {\sc Positive (1 in 3)-3sat}.
\end{lema}

% \setcounter{prove}{3}
\begin{proof}
Suponha que $G_F$ possui uma representação $B_1$-EPG-Helly, $R_{G_F}$. A partir de $R_{G_F}$ construiremos uma atribuição que satisfaz $F$. 

Primeiro, note que em toda representação de dobra simples de um $K_{2,4}$, o caminho de cada vértice do maior conjunto estável, em particular $P_{T}$ (em $R_{G_F}$), possui dobras contidas em uma torta falsa (ver Fato~\ref{fact:k24facts}). 


O vértice  $T$ é adjacente aos vértices de um triângulo de  $G_{B1}$ e $G_{B2}$. Como o $K_{2,4}$ está posicionado na dobra de  $P_{T}$, então em $R_{G_F}$ a representação de $G_{B1}$ e $G_{B2}$ devem ser posicionadas nas extremidades de $P_{T}$, ver Lema~\ref{lem:obstrucao}.   


Sem perda de generalidade, considere que $P_{V} \cap P_{T}$ é um segmento horizontal em $R_{G_F}$.

Podemos notar em $R_{G_F}$ que: o número de caminhos $P_{d}$ com segmento internamente contido em  $P_{V}$ é exatamente o número de cláusulas em $F$; a intersecção entre cada  $P_{a}, P_{e}, P_{h}$ no  dispositivo cláusula e cada caminho $P_{v_j}$ indica as variáveis que compõem a cláusula. Assim, podemos atribuir para cada variável $ x_{j}$ o valor \textit{True} se a aresta intersectante entre $P_{v_j}$ e $P_{T}$ é horizontal, e \textit{False} caso contrário. 


No Lema~\ref{lem:2vertical2horizontal} foi mostrado que qualquer representação minimal $B_1$-EPG de um dispositivo cláusula possui dois caminhos em $\{P_{a}, P_{d}, P_{e}, P_{h}\}$ com direção vertical e outros dois caminhos possuem direção horizonal. Além disso $P_{d}$ intersecta $P_{V}$, segue-se que em uma representação de dobra simples de  $G_F$ devemos conectar dois desses caminhos de forma a representar uma atribuição $False$, e exatamente um representará uma atribuição $True$. Assim, mostramos que a partir de $R_{G_F}$ podemos obter uma atribuição para $F$ tal que toda cláusula possui exatamente uma variável com valor $True$.
 \end{proof}


Note que uma representação $B_1$-EPG é  Helly se e somente se cada clique é representada por uma  clique-aresta (e não por uma  clique-garra). Mais detalhes sobre clique-aresta e clique-garra podem ser encontrados em~\cite{golumbic2009}. Assim, uma maneira alternativa para checar que uma representação é Helly seria notar que todas as cliques estão representadas como cliques-aresta.

\smallskip

Alguns vértices de  $G_F$ tem representação $B_1$-EPG altamente restritiva. O vértice $T$ possui sua dobra e ambas extremidades obstruídas por seus vizinhos, subgrafos $G_{B1}$, $G_{B2}$ e o restante do grafo $K_{2,4}$. O vértice $V$ e cada  vértice-variável $v_i$ deve ter um de seus segmentos internamente contigo em  $T$, e também suas extremidades e dobra obstruídos.  Portanto, o vértice $V$ e cada 
vértice-variável possui somente um segmento cada que pode ser utilizado em uma representação EPG para fazer a adjacência deles ao dispositivo cláusula. A direção desse segmento, começando pela horizontal ou vertical, pode ser utilizado para representar uma valoração $True$ ou $False$ para as variáveis. O  dispositivo cláusula, por outro lado, é tal que exatamente duas de suas adjacências aos vértices-variável e a $V$ pode ser efetuada com uma intersecção horizontal enquanto as outras duas  devem ser realizadas com intersecção vertical. Se considerarmos a direção utilizada por  $V$ como uma atribuição verdadeira, podemos notar que exatamente uma das variáveis em cada cláusula será $True$ em qualquer possível representação de  $G_F$. Por outro lado, é razoavelmente simples obter uma representação $B_1$-EPG para $G_F$ dada uma atribuição verdadeira para a fórmula $F$.


\begin{theorem}
{\sc Reconhecimento de grafos $B_{1}$-EPG-Helly } é NP-completo.
\end{theorem}
\begin{proof}
Pelo Teorema~\ref{teo:nppertinencia} e Lemas~\ref{lem:ida} e~\ref{lem:volta}.
 \end{proof} %$\square$

Dizemos que um grafo $k$-apex é um grafo que pode ser feito planar pela remoção de $k$ vértices. Além do mais, um grafo $d$-degenerado é um grafo em que todo subgrafo possui um vértice de grau no máximo $d$. Lembrando que  {\sc Positive (1 in 3)-3SAT} permanece $NP$-completo quando o grafo de incidência da fórmula de entrada é planar~\cite{mulzer2008minimum}. Assim, o seguinte corolário é válido.

\begin{corollary}
 \label{coro:2apexAnd3degenerate}
{\sc Reconhecimento de grafos $B_{1}$-EPG-Helly} é NP-completo sobre grafos $2$-apex e $3$-degenerado.
\end{corollary}

\begin{proof}
É fácil ver que os grafos construídos de acordo com a Definição~\ref{sec:reducao} são $3$-degenerados.
Como {\sc Positive (1in3)-3SAT} permanece $NP$-completo quando o grafo de incidência da fórmula  $F$ é planar~\cite{mulzer2008minimum},  de uma instância $F$ de {\sc Planar Positive (1in3)-3SAT}, então usando uma representação planar do grafo de incidência de $F$, podemos observar que pela remoção de $V$ e $T$ de $G_F$ obtemos um grafo planar. Logo, $G_F$ é 2-apex. 
\end{proof}


Para provar que $G_F$ é 3-degenerado basta aplicar o algoritmo de reconhecimento de grafos $d$-degenerados, que consiste em repetidamente remover os vértices de grau mínimo do grafo. Note que o vértice a ser removido a cada iteração do algoritmo sempre possui grau no máximo três, e portanto $G_F$ é 3-degenerado.

%Para elucidar o Corolário~\ref{coro:2apexAnd3degenerate}, que pode não ser trivial, sugerimos o seguinte raciocínio para provar que $G_F$ é 3-degenerado: aplicar o algoritmo de reconhecimento de grafos $d$-degenerados. 
A título de exemplo apresentamos a seguir uma construção para esclarecer a segunda parte do corolário. Tomemos a fórmula $F=(x_1+x_2+x_3)\wedge(x_1+x_3+x_4)\wedge(x_1+x_2+x_4)$, que  é uma instância de {\sc Planar Positive (1in3)-3SAT} e vamos mostrar que o dispositivo específico $G_F$ gerado a partir dessa instância é um grafo 2-apex.

Primeiro, monte o grafo de incidência de $F$, chamemos ele de $I_F$. O grafo de incidência é um grafo bipartido onde uma das partições está relacionada com as cláusulas de $F$ e a outra partição está relacionada com as suas variáveis. Cada cláusula $C_i$ de $F$ é representada por um vértice $v_{c_i}$ e cada variável $x_j$ das cláusulas é representada por um vértice $v_{x_j}$. Uma aresta  $(v_{c_i}, v_{x_j})$ existe em $I_F$ se e somente se a variável $x_j$ ocorre na cláusula $C_i$. A Figura~\ref{fig:grafoIncidencia2apex} retrata uma construção do grafo de incidência $I_F$.

\input{./includes/include-img/grafoIncidencia2apex.tex}

Como a fórmula $F$ que originou o grafo $I_F$ é uma instância de {\sc Planar Positive (1in3)-3SAT}, sabemos que o grafo de incidência da fórmula  $F$ é também planar~\cite{mulzer2008minimum}. A Figura~\ref{fig:grafoIncidencia2apexPlanar} retrata uma representação planar de $I_F$.


\input{./includes/include-img/grafoIncidencia2apexPlanar.tex}

Finalmente, podemos substituir os vértices que representavam as variáveis e cláusulas em $I_F$ pelos dispositivos variáveis e cláusulas correspondentes. Os vértices $V$ e $T$ são removidos. Como cada dispositivo variável, dispositivo cláusula e dispositivo base individualmente era planar, então algo não planar pode ter surgido somente da intersecção que foi feita entre eles. Como $I_F$ garante que existe um arranjo planar entre as intersecções dos dispositivos variável e dispositivos cláusula, então quando removemos $V$ e $T$, tudo o que sobra do grafo é planar, ver Figura~\ref{fig:grafoIncidenciaCompleto}. Logo $G_F$ é 2-apex.


\input{./includes/include-img/grafoIncidenciaCompleto.tex}